<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Science Search</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #ffffff;
            --bg-secondary: #f8f9fa;
            --text: #1a1a1a;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --accent: #6366f1;
            --accent-light: #818cf8;
        }

        [data-theme="dark"] {
            --bg: #0a0a0a;
            --bg-secondary: #171717;
            --text: #f5f5f5;
            --text-light: #a3a3a3;
            --border: #262626;
            --accent: #818cf8;
            --accent-light: #a5b4fc;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s;
        }

        /* Navbar */
        .navbar {
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background 0.2s;
        }

        .theme-toggle:hover {
            background: var(--bg-secondary);
        }

        /* Main */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .subtitle {
            color: var(--text-light);
            text-align: center;
            margin-bottom: 3rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        /* Search */
        .search-container {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .search-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-icon:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .search-input {
            flex: 1;
            padding: 0 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 0.9375rem;
            background: var(--bg);
            color: var(--text);
            outline: none;
            transition: border 0.2s;
        }

        .search-input:focus {
            border-color: var(--accent);
        }

        /* Question Generator */
        .controls {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .select {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 0.9375rem;
            cursor: pointer;
            outline: none;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--accent-light);
        }

        /* Question Card */
        .question-card {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-card:hover {
            border-color: var(--accent);
            background: var(--bg-secondary);
        }

        .question-text {
            flex: 1;
            font-size: 0.9375rem;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-easy { background: #10b981; color: white; }
        .badge-medium { background: #f59e0b; color: white; }
        .badge-hard { background: #ef4444; color: white; }

        /* Answer */
        .answer {
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .answer h3 {
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }

        .answer p {
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        .answer strong {
            color: var(--accent);
        }

        .answer ul, .answer ol {
            margin: 1rem 0 1rem 1.5rem;
        }

        .answer li {
            margin-bottom: 0.5rem;
        }

        /* Diagram */
        .diagram {
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .diagram h3 {
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        /* Sources */
        .sources {
            margin-top: 2rem;
        }

        .sources h3 {
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }

        .source {
            padding: 1rem;
            border-left: 3px solid var(--accent);
            background: var(--bg-secondary);
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .source-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .source-text {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        /* Empty State */
        .empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-light);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        /* Book Carousel */
        .book-carousel {
            position: relative;
            overflow: hidden;
            padding: 2rem 0;
            margin-bottom: 2rem;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        .book-track {
            display: flex;
            gap: 1.5rem;
            animation: scroll 30s linear infinite;
        }

        .book-track:hover {
            animation-play-state: paused;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .book {
            flex-shrink: 0;
            width: 140px;
            height: 200px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
            background: var(--bg-secondary);
        }

        .book:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
        }

        .book img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .carousel-hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .title {
                font-size: 2rem;
            }

            .container {
                padding: 2rem 1rem;
            }

            .controls {
                flex-direction: column;
            }

            .question-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .book {
                width: 120px;
                height: 170px;
            }

            .book-title {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">Data Science Search</div>
        <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">üåô</button>
    </nav>

    <!-- Main -->
    <div class="container">
        <h1 class="title">Master Data Science with AI</h1>
        <p class="subtitle">Search through data science books and generate study questions</p>

        <!-- Book Carousel -->
        <div class="book-carousel" id="book-carousel">
            <div class="book-track" id="book-track">
                <!-- Books will be loaded here -->
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('search')">Search</button>
            <button class="tab" onclick="switchTab('questions')">Study Questions</button>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content active">
            <div class="search-container">
                <div class="search-icon" onclick="search()">üîç</div>
                <input
                    id="query"
                    class="search-input"
                    type="text"
                    placeholder="Ask anything about data science..."
                    autofocus
                >
            </div>
            <div id="results"></div>
        </div>

        <!-- Questions Tab -->
        <div id="questions-tab" class="tab-content">
            <div class="controls">
                <select id="difficulty" class="select">
                    <option value="random">Random Mix</option>
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
                <button class="btn" onclick="generateQuestions()">Generate</button>
            </div>
            <div id="questions">
                <div class="empty">Click "Generate" to create study questions</div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: false,
            theme: document.body.dataset.theme === 'dark' ? 'dark' : 'default'
        });
        window.mermaid = mermaid;
    </script>
    <script>
        const supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const theme = body.dataset.theme === 'light' ? 'dark' : 'light';
            body.dataset.theme = theme;
            document.getElementById('theme-btn').textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', theme);

            if (window.mermaid) {
                window.mermaid.initialize({ theme: theme === 'dark' ? 'dark' : 'default' });
            }
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.dataset.theme = savedTheme;
        document.getElementById('theme-btn').textContent = savedTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';

        // Tab Switching
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        window.switchTab = switchTab;

        // Enter key search
        document.getElementById('query').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') search();
        });

        // Extract keywords
        function extractKeywords(query) {
            const stopWords = new Set([
                'what', 'is', 'are', 'the', 'a', 'an', 'how', 'why', 'when', 'where',
                'who', 'which', 'does', 'do', 'can', 'could', 'would', 'should',
                'tell', 'me', 'about', 'explain', 'describe', 'define', 'of', 'in', 'on'
            ]);

            const semanticExpansions = {
                'neural': ['network', 'neuron', 'deep learning', 'backpropagation'],
                'gradient': ['descent', 'backpropagation', 'optimization'],
                'decision': ['tree', 'forest', 'classification'],
                'machine': ['learning', 'ml', 'model', 'algorithm'],
                'deep': ['learning', 'neural', 'network'],
                'regression': ['linear', 'logistic', 'prediction'],
                'classification': ['supervised', 'model', 'predict']
            };

            const words = query.toLowerCase()
                .replace(/[?.,!;:]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 2 && !stopWords.has(word));

            const keywords = new Set(words);
            words.forEach(word => {
                if (semanticExpansions[word]) {
                    semanticExpansions[word].forEach(related => {
                        related.split(' ').forEach(term => {
                            if (term.length > 2) keywords.add(term);
                        });
                    });
                }
            });

            return Array.from(keywords);
        }

        // Calculate relevance
        function calculateRelevance(content, keywords, query = '') {
            const lower = content.toLowerCase();
            let score = 0;

            if (query && lower.includes(query.toLowerCase())) score += 200;

            keywords.forEach((keyword, i) => {
                const weight = i < 3 ? 15 : 8;
                const regex = new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
                const matches = lower.match(regex);

                if (matches) {
                    score += matches.length * weight;
                    const firstIndex = lower.indexOf(keyword);
                    if (firstIndex < 100) score += 30;
                    else if (firstIndex < 300) score += 15;
                }
            });

            if (content.length < 200) score *= 0.5;
            if (content.length > 500 && content.length < 2000) score *= 1.2;

            return score;
        }

        // Extract sentences
        function extractSentences(content, keywords) {
            const cleaned = content
                .replace(/={10,}/g, '')
                .replace(/PAGE \d+/gi, '')
                .trim();

            const sentences = cleaned.split(/[.!?]+/).filter(s => s.length > 20);
            const scored = sentences.map(sentence => {
                let score = 0;
                const lower = sentence.toLowerCase();
                keywords.forEach(keyword => {
                    if (lower.includes(keyword)) score += 10;
                });
                return { sentence, score };
            });

            return scored
                .filter(s => s.score > 0)
                .sort((a, b) => b.score - a.score)
                .map(s => s.sentence);
        }

        // Compose answer
        async function composeAnswer(results, keywords, query) {
            const sources = [];
            let context = '';

            results.slice(0, 10).forEach(item => {
                const sentences = extractSentences(item.content, keywords);
                if (sentences.length > 0) {
                    context += `\n[From: ${item.book_name}]\n${sentences.slice(0, 6).join(' ')}\n`;
                    sources.push({
                        book: item.book_name,
                        chunk: item.page_number,
                        excerpt: sentences[0]
                    });
                }
            });

            if (!context.trim()) {
                return {
                    answer: '<p>No relevant information found. Try different keywords.</p>',
                    sources: []
                };
            }

            const aiAnswer = await generateAIAnswer(query, context);
            return { answer: aiAnswer, sources: sources.slice(0, 5) };
        }

        // Generate AI answer
        async function generateAIAnswer(question, context) {
            const GROQ_API_KEY = CONFIG.GROQ_API_KEY;

            if (!GROQ_API_KEY || GROQ_API_KEY === 'YOUR_GROQ_API_KEY_HERE') {
                return '<p>‚ö†Ô∏è Please add your Groq API key to config.js</p>';
            }

            const prompt = `You are a Data Science expert. Answer the student's question using the book excerpts provided.

Instructions:
- Use **bold** for key terms
- Be clear and concise
- Include a Mermaid diagram if helpful, using this format:

[MERMAID_DIAGRAM]
graph TD
    A[Start] --> B[Process]
[/MERMAID_DIAGRAM]

Question: "${question}"

Book Excerpts:
${context}

Answer:`;

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'llama-3.3-70b-versatile',
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.7,
                        max_tokens: 1500
                    })
                });

                const result = await response.json();
                if (result.error) throw new Error(result.error.message);

                return formatAnswer(result.choices[0].message.content);
            } catch (error) {
                return `<p>‚ö†Ô∏è Error: ${error.message}</p>`;
            }
        }

        // Format answer
        function formatAnswer(text) {
            const diagramRegex = /\[MERMAID_DIAGRAM\]([\s\S]*?)\[\/MERMAID_DIAGRAM\]/;
            const match = text.match(diagramRegex);
            let diagram = null;
            let content = text;

            if (match) {
                diagram = match[1].trim();
                content = text.replace(diagramRegex, '').trim();
            }

            let formatted = content
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/`(.+?)`/g, '<code>$1</code>');

            const lines = formatted.split('\n');
            let html = [];
            let inList = false;
            let listType = null;

            for (let line of lines) {
                line = line.trim();

                if (line.match(/^[-‚Ä¢*]\s+(.+)/)) {
                    if (!inList) {
                        html.push('<ul>');
                        inList = true;
                        listType = 'ul';
                    }
                    html.push(`<li>${line.replace(/^[-‚Ä¢*]\s+/, '')}</li>`);
                } else if (line.match(/^\d+\.\s+(.+)/)) {
                    if (!inList) {
                        html.push('<ol>');
                        inList = true;
                        listType = 'ol';
                    }
                    html.push(`<li>${line.replace(/^\d+\.\s+/, '')}</li>`);
                } else if (line.length > 0) {
                    if (inList) {
                        html.push(`</${listType}>`);
                        inList = false;
                    }
                    html.push(`<p>${line}</p>`);
                } else if (inList) {
                    html.push(`</${listType}>`);
                    inList = false;
                }
            }

            if (inList) html.push(`</${listType}>`);

            return { html: html.join(''), diagram };
        }

        // Search
        async function search() {
            const query = document.getElementById('query').value.trim();
            if (!query) return;

            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading">Searching...</div>';

            try {
                const keywords = extractKeywords(query);
                if (keywords.length === 0) {
                    results.innerHTML = '<div class="empty">Please enter a more specific query</div>';
                    return;
                }

                let allResults = [];
                for (const keyword of keywords) {
                    const { data, error } = await supabase
                        .from('documents')
                        .select('*')
                        .ilike('content', `%${keyword}%`)
                        .limit(50);

                    if (error) throw error;
                    if (data) allResults = allResults.concat(data);
                }

                const unique = Array.from(
                    new Map(allResults.map(item => [`${item.book_name}-${item.page_number}`, item])).values()
                );

                if (unique.length === 0) {
                    results.innerHTML = '<div class="empty">No results found</div>';
                    return;
                }

                const scored = unique
                    .map(item => ({ ...item, relevance: calculateRelevance(item.content, keywords, query) }))
                    .sort((a, b) => b.relevance - a.relevance)
                    .slice(0, 20);

                results.innerHTML = '<div class="loading">Generating answer...</div>';

                const { answer, sources } = await composeAnswer(scored, keywords, query);

                let html = `<div class="answer">
                    <h3>Answer</h3>
                    ${answer.html}
                </div>`;

                if (answer.diagram) {
                    html += `<div class="diagram">
                        <h3>Diagram</h3>
                        <div class="mermaid" id="diagram">${answer.diagram}</div>
                    </div>`;
                }

                if (sources.length > 0) {
                    html += '<div class="sources"><h3>Sources</h3>';
                    sources.forEach(source => {
                        html += `<div class="source">
                            <div class="source-title">${source.book} - Chunk ${source.chunk}</div>
                            <div class="source-text">${source.excerpt.substring(0, 200)}...</div>
                        </div>`;
                    });
                    html += '</div>';
                }

                results.innerHTML = html;

                if (answer.diagram && window.mermaid) {
                    await window.mermaid.run({ querySelector: '#diagram' });
                }
            } catch (error) {
                results.innerHTML = `<div class="empty">Error: ${error.message}</div>`;
            }
        }

        window.search = search;

        // Generate Questions
        async function generateQuestions() {
            const questionsDiv = document.getElementById('questions');
            questionsDiv.innerHTML = '<div class="loading">Generating...</div>';

            try {
                const { count } = await supabase
                    .from('documents')
                    .select('*', { count: 'exact', head: true });

                const offset = Math.floor(Math.random() * (count - 20));
                const { data, error } = await supabase
                    .from('documents')
                    .select('*')
                    .range(offset, offset + 19);

                if (error) throw error;

                const content = data.map(d => d.content).join(' ');
                const difficulty = document.getElementById('difficulty').value;

                let instruction = 'Generate 5 data science interview questions.';
                if (difficulty === 'easy') instruction = 'Generate 5 EASY questions about basic concepts.';
                if (difficulty === 'medium') instruction = 'Generate 5 MEDIUM questions about practical applications.';
                if (difficulty === 'hard') instruction = 'Generate 5 HARD questions about advanced concepts.';

                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'llama-3.3-70b-versatile',
                        messages: [{ role: 'user', content: instruction }],
                        temperature: 1.0,
                        max_tokens: 400
                    })
                });

                const result = await response.json();
                const text = result.choices[0].message.content;
                const questions = text.split('\n').filter(line => line.match(/^\d+\./));

                displayQuestions(questions, difficulty);
            } catch (error) {
                questionsDiv.innerHTML = `<div class="empty">Error: ${error.message}</div>`;
            }
        }

        window.generateQuestions = generateQuestions;

        // Display Questions
        function displayQuestions(questions, difficulty) {
            const questionsDiv = document.getElementById('questions');
            const difficulties = difficulty === 'random'
                ? questions.map(() => ['easy', 'medium', 'hard'][Math.floor(Math.random() * 3)])
                : questions.map(() => difficulty);

            questionsDiv.innerHTML = questions.map((q, i) => {
                const text = q.replace(/^\d+\.\s*/, '');
                return `<div class="question-card" onclick="searchQuestion('${text.replace(/'/g, "\\'")}')">
                    <div class="question-text">${text}</div>
                    <span class="badge badge-${difficulties[i]}">${difficulties[i]}</span>
                </div>`;
            }).join('');
        }

        // Search Question
        function searchQuestion(question) {
            switchTab('search');
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.querySelectorAll('.tab')[1].classList.remove('active');
            document.getElementById('query').value = question;
            search();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.searchQuestion = searchQuestion;

        // Book cover image mapping - all available books
        const allBooks = [
            { name: 'A Mathematical Introduction to Data Science', cover: 'book-covers/mathematical-intro.jpg' },
            { name: 'Data Science: An Introduction to Statistics and Machine Learning', cover: 'book-covers/data-science.jpg' },
            { name: 'Data Science in Practice', cover: 'book-covers/data-science-practice.jpg' },
            { name: 'Data Science: Foundations and Hands-on Experience', cover: 'book-covers/data-science-foundations.jpg' },
            { name: 'Introduction to Data Science', cover: 'book-covers/intro-data-science.jpg' },
            { name: 'Materials Data Science', cover: 'book-covers/materials-data-science.jpg' },
            { name: 'Python for Data Science', cover: 'book-covers/python-data-science.jpg' }
        ];

        // Search for book summary
        async function searchBookSummary(bookName) {
            // Switch to search tab
            switchTab('search');
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.querySelectorAll('.tab')[1].classList.remove('active');

            // Set query
            const query = `Give me a summary of the book "${bookName}" including author, key topics, and what it covers`;
            document.getElementById('query').value = query;

            // Perform search
            await search();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Load Book Carousel
        async function loadBookCarousel() {
            try {
                const track = document.getElementById('book-track');

                // Create book cards from all available books
                const bookCards = allBooks.map(book => {
                    return `
                        <div class="book" onclick="searchBookSummary('${book.name.replace(/'/g, "\\'")}')">
                            <img src="${book.cover}" alt="${book.name}">
                        </div>
                    `;
                }).join('');

                // Duplicate the books to create seamless loop
                track.innerHTML = bookCards + bookCards;

            } catch (error) {
                console.error('Error loading books:', error);
                document.getElementById('book-carousel').style.display = 'none';
            }
        }

        window.searchBookSummary = searchBookSummary;

        // Load carousel on page load
        loadBookCarousel();

        // Hide carousel when showing search results
        const originalSearch = window.search;
        window.search = async function() {
            await originalSearch();
            const carousel = document.getElementById('book-carousel');
            if (document.getElementById('results').innerHTML.includes('class="answer"')) {
                carousel.classList.add('carousel-hidden');
            }
        };
    </script>
</body>
</html>
